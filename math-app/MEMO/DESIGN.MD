# 小学4年生 算数・親子の絆アプリ 開発ドキュメント

## 1. プロジェクトの全体像 (Concept)

### 目的
* **娘（小4）の算数学習のサポート:** 「分数」など、つまずきやすい単元を視覚的（SVG）に理解させる。
* **親子のコミュニケーション:** 勉強を通じて父親が関わり、褒めるきっかけを作る。
* **ペーパーレス化:** 紙のドリルにおける「採点の手間」「解説不足」をアプリで解消する。

### ターゲットユーザー
* **学習者:** 娘（Androidスマホ利用）。
* **管理者:** 私（学習進捗の確認、問題データの追加）。

### コア機能
1.  **教科書モード (Input):** アニメーションや図解を用いた「読む」学習。
2.  **問題集モード (Output):** 選択式問題などで理解度をチェック（※今後実装）。
3.  **ご褒美機能:** 頑張りが可視化される仕組み（※今後実装）。

---

## 2. 基本設計 (Basic Design)

### 技術スタック
* **フレームワーク:** React + Vite
* **言語:** JavaScript (JSX)
* **スタイル:** Inline CSS (Flexbox中心)
* **データ管理:** JSONファイル (`src/textbookData.json`)
* **プラットフォーム:** Webアプリ (PWA化してAndroidのホーム画面に追加予定)
* **デプロイ:** GitHub Pages (予定)

### データフロー
1.  **データ作成:** スプレッドシート等で構成を練り、JSON形式に変換。
2.  **データ読込:** アプリ起動時にJSONを読み込み。
3.  **描画:** `step_no` に応じて該当データを抽出。HTMLとSVGを組み合わせてレンダリング。

---

## 3. 詳細設計 (Detailed Design)

### 画面構成 (教科書モード)
* **ヘッダー:** 単元名と進捗バー（Step x / y）。
* **メインビジュアル:** **「ハイブリッド方式」**を採用（後述）。
* **説明文:** HTMLタグを含むテキスト表示。
* **フッター:** 「もどる」「つぎへ」ボタンによるページネーション。

### ★重要な技術的決定：ハイブリッド描画方式
初期は「全てSVGで描画」しようとしたが、文字の配置ズレやレイアウト崩れが多発したため、以下の方式に変更した。

* **図形 (SVG):**
    * 純粋な図形（テープ、ビーカーの枠、塗りつぶし）のみを描画。
    * 文字は含めない。
    * 座標計算を単純化（例：テープは長さを変えるのではなく、同じ四角形を3つ並べる「ブロック積み上げ方式」を採用）。
* **文字・数式 (HTML/CSS):**
    * Flexboxを使って配置。
    * 分数は `border-bottom` を使った縦積みレイアウトで表現（教科書表記に準拠）。
    * SVGとHTMLを `<div>` でラップし、Flexboxで位置関係を制御する。

### データ構造 (JSONスキーマ)
`src/textbookData.json` の構成：

| キー | 型 | 説明 |
| :--- | :--- | :--- |
| `id` | string | ユニークID (例: `t_d14_05`) |
| `unit_id` | string | 単元ID (例: `D14`) |
| `step_no` | number | 表示順序 |
| `title` | string | ページタイトル |
| `text_main` | string | 説明文 (HTMLタグ使用可) |
| `visual_html` | string | **最重要項目**。SVGコードとHTMLタグを組み合わせた描画用文字列。 |

---

## 4. ディレクトリ構成 (Architecture)

```text
math-app/
├── public/          # 静的ファイル
├── src/
│   ├── assets/      # 画像など
│   ├── App.jsx      # メインロジック（ページ送り、表示制御）
│   ├── main.jsx     # エントリーポイント
│   ├── textbookData.json # ★ここに問題・解説データが入っている
│   └── index.css    # 全体のスタイル
├── index.html       # ベースのHTML
└── package.json     # 設定ファイル