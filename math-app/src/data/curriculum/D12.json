[
  {
    "pattern_id": "D12-U01-P01",
    "title": "１より小さい「はした」の大きさ",
    "problem": {
      "question_text": "コップに入った水のかさをはかります。$1\\text{dL}$ますに入りきらない、半端な残り（はした）が出ました。この残りの水のかさは、どのように表せばよいでしょうか？",
      "numbers": {
        "unit": "dL"
      },
      "answer": "整数では表せないため、新しい数の表し方が必要"
    },
    "visual_structure": {
      "summary": "水のかさを測定する場面。整数の限界を示す。",
      "elements": [
        "1dLますが1つ満杯",
        "もう1つの1dLますには半分以下の水（はした）",
        "「1dLよりも少ない！」というフキダシ"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "水のかさをはかってみよう。 $1\\text{dL}$ます $1$つ分は あるけれど、もう $1$つは いっぱいには なっていないね。",
        "action_type": "observation",
        "highlight_target": "partial_cup"
      },
      {
        "step_id": 2,
        "guide_text": "$1\\text{dL}$より 少ない 水だね。これは「$1$」や「$2$」のような 整数では 表せないよ。どうしたら いいかな？",
        "action_type": "question",
        "highlight_target": "question_mark"
      }
    ]
  },
  {
    "pattern_id": "D12-U01-P02",
    "title": "新しい数「０.１」を知ろう",
    "problem": {
      "question_text": "$1\\text{dL}$のますを横に$10$等分しました。その$1$つ分のかさは、何$\\text{dL}$といえばよいでしょうか？",
      "numbers": {
        "division": 10
      },
      "answer": "0.1dL"
    },
    "visual_structure": {
      "summary": "1dLを10等分した目盛りを見せる。",
      "elements": [
        "10等分の目盛りが入った1dLます",
        "一番下の1目盛り分だけ青く塗られている",
        "「0.1dL」という表記の強調"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "$1\\text{L}$や$1\\text{dL}$を $10$こに 分けた $1$つ分の ことを、分数で $\\frac{1}{10}$（10分の1）と 習ったね。",
        "action_type": "recall",
        "highlight_target": "fraction_1_10"
      },
      {
        "step_id": 2,
        "guide_text": "この量は、新しい数を使って「$0.1\\text{dL}$」とも 書くことができるんだ。 これを「小数（しょうすう）」と いうよ。",
        "action_type": "definition",
        "highlight_target": "decimal_0_1"
      }
    ]
  },
  {
    "pattern_id": "D12-U01-P03",
    "title": "小数の書き方と読み方",
    "problem": {
      "question_text": "次の数を数字で書きましょう。\n\n「れいてんいち」",
      "numbers": {
        "val": 0.1
      },
      "answer": "0.1"
    },
    "visual_structure": {
      "summary": "小数の書き順アニメーション。",
      "elements": [
        "書き順ガイド付きの「0.1」",
        "「.（小数点）」を打つ動作の強調エフェクト",
        "読みがな「れいてんいち」"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "書き方を 練習しよう。 まず「$0$」を 書いて、その右下に 小さく ポチッと 点を 打つよ。これを「小数点（しょうすうてん）」と いうよ。",
        "action_type": "write_guide",
        "highlight_target": "decimal_point"
      },
      {
        "step_id": 2,
        "guide_text": "最後に「$1$」を 書くよ。「$0.1$」と書いて、「れいてんいち」と 読むんだ。",
        "action_type": "read_guide",
        "highlight_target": "reading_text"
      }
    ]
  },
  {
    "pattern_id": "D12-U01-P04",
    "title": "長さを小数で表そう",
    "problem": {
      "question_text": "えんぴつの長さをはかると、$8\\text{cm}$ $5\\text{mm}$ でした。\nこの長さは 何$\\text{cm}$ ですか？",
      "numbers": {
        "cm": 8,
        "mm": 5
      },
      "answer": "8.5cm"
    },
    "visual_structure": {
      "summary": "定規で鉛筆を測る図。拡大図付き。",
      "elements": [
        "8cmと9cmの間にある鉛筆の先",
        "1mmが0.1cmであることを示す補助線",
        "答えの枠「□ cm」"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "$1\\text{mm}$は、$1\\text{cm}$を $10$等分した 長さだね。だから、$1\\text{mm} = 0.1\\text{cm}$ と 表せるよ。",
        "action_type": "conversion_rule",
        "highlight_target": "mm_to_cm"
      },
      {
        "step_id": 2,
        "guide_text": "$5\\text{mm}$は $0.1\\text{cm}$が $5$こ分だから、$0.5\\text{cm}$ だね。",
        "action_type": "calculation",
        "highlight_target": "5mm_part"
      },
      {
        "step_id": 3,
        "guide_text": "$8\\text{cm}$と $0.5\\text{cm}$を あわせて、$8.5\\text{cm}$ に なるよ。",
        "action_type": "final_answer",
        "highlight_target": "answer_box"
      }
    ]
  },
  {
    "pattern_id": "D12-U02-P01",
    "title": "１より大きい小数の表し方",
    "problem": {
      "question_text": "$1\\text{L}$の ます $1$つ分と、$0.3\\text{L}$の 水が あります。\nあわせると 何$\\text{L}$に なりますか？",
      "numbers": {
        "integer_part": 1,
        "decimal_part": 0.3
      },
      "answer": "1.3L"
    },
    "visual_structure": {
      "summary": "整数部分と小数部分の合体。",
      "elements": [
        "1Lの水が入ったビーカー",
        "0.3Lの水が入ったビーカー",
        "合体して「1.3L」になるアニメーション矢印"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "$1\\text{L}$と $0.3\\text{L}$を あわせた 数を「$1.3$」と 書いて、「いってんさん」と 読むよ。",
        "action_type": "combine",
        "highlight_target": "result_text"
      },
      {
        "step_id": 2,
        "guide_text": "$2$と $0.5$なら $2.5$、$5$と $0.8$なら $5.8$ のように 表すことができるよ。",
        "action_type": "example_expand",
        "highlight_target": "other_examples"
      }
    ]
  },
  {
    "pattern_id": "D12-U02-P02",
    "title": "小数のしくみと「くらい」",
    "problem": {
      "question_text": "数字の「$2.5$」を位（くらい）の部屋に分けます。$5$は どの位の 数字ですか？",
      "numbers": {
        "target_number": 2.5
      },
      "answer": "十分の一の位"
    },
    "visual_structure": {
      "summary": "位取り表への配置。",
      "elements": [
        "「一の位」と「十分の一の位」と書かれた表",
        "一の位に「2」、十分の一の位に「5」が入る",
        "小数点が位の境目にある"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "整数のときと同じように、小数にも「位（くらい）」があるよ。\n小数点の すぐ 右がわの 位を「十分の一の位（じゅうぶんのいちのくらい）」と いうよ。",
        "action_type": "definition",
        "highlight_target": "tenths_place_label"
      },
      {
        "step_id": 2,
        "guide_text": "$2.5$の $2$は「一の位」、$5$は「十分の一の位」の 数字だね。",
        "action_type": "identify",
        "highlight_target": "number_5"
      }
    ]
  },
  {
    "pattern_id": "D12-U02-P03",
    "title": "０.１がいくつ集まった数？",
    "problem": {
      "question_text": "$2.3$ は、$0.1$を 何こ 集めた数ですか？",
      "numbers": {
        "target": 2.3
      },
      "answer": "23こ"
    },
    "visual_structure": {
      "summary": "0.1のブロックが積み上がるイメージ。",
      "elements": [
        "「1」は「0.1」が10個集まったものという図解",
        "「2」は20個分、「0.3」は3個分",
        "合計23個のブロック"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "$1$は、$0.1$を $10$こ 集めた 大きさだね。だから $2$は、$0.1$が $20$こ分だ。",
        "action_type": "breakdown_integer",
        "highlight_target": "integer_blocks"
      },
      {
        "step_id": 2,
        "guide_text": "$0.3$は $0.1$が $3$こ分だね。あわせると、$20 + 3$で…？ ",
        "action_type": "sum_up",
        "highlight_target": "total_count"
      },
      {
        "step_id": 3,
        "guide_text": "そう、$23$こ 集めた数になるね。",
        "action_type": "answer",
        "highlight_target": "answer_text"
      }
    ]
  },
  {
    "pattern_id": "D12-U03-P01",
    "title": "数直線で場所をさがそう",
    "problem": {
      "question_text": "下の数直線の $\\uparrow$ が指している数は いくつですか？",
      "numbers": {
        "position": 2.5
      },
      "answer": "2.5"
    },
    "visual_structure": {
      "summary": "数直線の読み取り。",
      "elements": [
        "0, 1, 2, 3の大きな目盛り",
        "各整数の間が10等分されている",
        "2と3のちょうど真ん中（5目盛り目）に矢印"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "まず、小さい目盛り $1$つ分の 大きさを 確かめよう。 $2$と $3$の間が $10$等分 されているから、小さい目盛りは $0.1$ ずつ 増えるよ。",
        "action_type": "scale_check",
        "highlight_target": "scale_0_1"
      },
      {
        "step_id": 2,
        "guide_text": "矢印は、$2$から 右へ 小さい目盛り $5$つ分 進んだところにあるね。",
        "action_type": "count",
        "highlight_target": "arrow_position"
      },
      {
        "step_id": 3,
        "guide_text": "だから、答えは $2.5$ だね。",
        "action_type": "answer",
        "highlight_target": "answer_text"
      }
    ]
  },
  {
    "pattern_id": "D12-U03-P02",
    "title": "小数の大きさ比べ",
    "problem": {
      "question_text": "次の２つの数の大きさを比べて、$\\square$ にあてはまる記号（$>, <$）を書きましょう。\n\n$2.8 \\; \\square \\; 3.1$",
      "numbers": {
        "a": 2.8,
        "b": 3.1
      },
      "answer": "<"
    },
    "visual_structure": {
      "summary": "シーソーによる大小比較。",
      "elements": [
        "左に2.8、右に3.1の重りが乗ったシーソー",
        "3.1の方が重い（下がっている）",
        "位ごとの比較アニメーション（まず一の位を見る）"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "大きさを比べるときは、上の位（くらい）から 順に 見ていくよ。まず「一の位」を 比べよう。",
        "action_type": "compare_integer",
        "highlight_target": "integer_part"
      },
      {
        "step_id": 2,
        "guide_text": "$2$ と $3$ では、$3$ の方が 大きいね。 だから、$3.1$ の方が 大きいよ。",
        "action_type": "conclusion",
        "highlight_target": "inequality_sign"
      }
    ]
  },
  {
    "pattern_id": "D12-U04-P01",
    "title": "小数のたし算（考え方）",
    "problem": {
      "question_text": "$0.3 + 0.2$ の計算をします。\n$0.1$ が いくつ分になるか考えて答えましょう。",
      "numbers": {
        "a": 0.3,
        "b": 0.2
      },
      "answer": "0.5"
    },
    "visual_structure": {
      "summary": "0.1の個数で考える足し算。",
      "elements": [
        "0.3（0.1ブロック3個）",
        "0.2（0.1ブロック2個）",
        "合体して5個になる図"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "$0.3$は $0.1$が $3$こ、$0.2$は $0.1$が $2$こ だね。",
        "action_type": "decomposition",
        "highlight_target": "blocks"
      },
      {
        "step_id": 2,
        "guide_text": "あわせると、$3 + 2$ で $5$こ分 になるよ。",
        "action_type": "calculation",
        "highlight_target": "sum_integer"
      },
      {
        "step_id": 3,
        "guide_text": "$0.1$が $5$こ分だから、答えは $0.5$ だね。",
        "action_type": "reconstruction",
        "highlight_target": "final_answer"
      }
    ]
  },
  {
    "pattern_id": "D12-U04-P02",
    "title": "小数のたし算の筆算",
    "problem": {
      "question_text": "次の計算を筆算でしましょう。\n$1.2 + 2.4$",
      "numbers": {
        "a": 1.2,
        "b": 2.4
      },
      "answer": "3.6"
    },
    "visual_structure": {
      "summary": "小数の筆算手順。",
      "elements": [
        "方眼紙上の筆算",
        "小数点（.）が縦に一直線に並んでいることを赤線で強調",
        "通常の足し算を行い、最後に点を下ろす"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "小数の筆算は、**「小数点（点）」の場所を たてにそろえて** 書くのが ポイントだよ。",
        "action_type": "setup",
        "highlight_target": "alignment_line"
      },
      {
        "step_id": 2,
        "guide_text": "整数のときと 同じように計算しよう。$2+4=6$、$1+2=3$ だね。",
        "action_type": "calculation",
        "highlight_target": "digits"
      },
      {
        "step_id": 3,
        "guide_text": "最後に、上の点と そろえて、答えにも 点を 打とう。",
        "action_type": "decimal_point",
        "highlight_target": "result_point"
      }
    ]
  },
  {
    "pattern_id": "D12-U04-P03",
    "title": "くり上がりのあるたし算",
    "problem": {
      "question_text": "次の計算をしましょう。\n$0.8 + 0.5$",
      "numbers": {
        "a": 0.8,
        "b": 0.5
      },
      "answer": "1.3"
    },
    "visual_structure": {
      "summary": "繰り上がりのある筆算。",
      "elements": [
        "0.8 + 0.5 の筆算",
        "8+5=13 の「1」が左隣（一の位）に移動するアニメーション",
        "答えの1.3"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "まず 十分の一の位を 計算しよう。$8 + 5 = 13$ だね。",
        "action_type": "calc_tenths",
        "highlight_target": "tenths_calc"
      },
      {
        "step_id": 2,
        "guide_text": "$13$の「$1$」は、一の位に くり上げよう。 $0.1$が $10$こ 集まると $1$に なるからだね。",
        "action_type": "carry_over",
        "highlight_target": "carry_mark"
      },
      {
        "step_id": 3,
        "guide_text": "一の位は くり上がった $1$ と $0$ を足して $1$。答えは $1.3$ だよ。",
        "action_type": "final_calc",
        "highlight_target": "answer"
      }
    ]
  },
  {
    "pattern_id": "D12-U04-P04",
    "title": "答えの「.０」をどうする？",
    "problem": {
      "question_text": "次の計算をしましょう。\n$2.3 + 1.7$",
      "numbers": {
        "a": 2.3,
        "b": 1.7
      },
      "answer": "4"
    },
    "visual_structure": {
      "summary": "4.0を4にする処理。",
      "elements": [
        "筆算の結果「4.0」が表示される",
        "「.0」の部分に斜線が引かれる",
        "最終的な答え「4」が強調される"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "計算すると、答えは $4.0$ に なったね。でも、これで 終わりじゃないよ。",
        "action_type": "check_result",
        "highlight_target": "result_4_0"
      },
      {
        "step_id": 2,
        "guide_text": "小数の 右はしの $0$ は 消す決まりがあるんだ。 「$4.0$」は「$4$」と 同じ 大きさだね。",
        "action_type": "cancel_zero",
        "highlight_target": "slash_zero"
      },
      {
        "step_id": 3,
        "guide_text": "だから、答えは「$4$」と 書こう。",
        "action_type": "final_answer",
        "highlight_target": "answer_4"
      }
    ]
  },
  {
    "pattern_id": "D12-U04-P05",
    "title": "小数のひき算の筆算",
    "problem": {
      "question_text": "次の計算を筆算でしましょう。\n$2.5 - 1.2$",
      "numbers": {
        "a": 2.5,
        "b": 1.2
      },
      "answer": "1.3"
    },
    "visual_structure": {
      "summary": "小数の引き算筆算。",
      "elements": [
        "点が揃った引き算の筆算",
        "5-2=3, 2-1=1 の計算過程",
        "小数点を下ろす矢印"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "ひき算も たし算と 同じように、位（小数点）を そろえて 書こう。",
        "action_type": "setup",
        "highlight_target": "alignment"
      },
      {
        "step_id": 2,
        "guide_text": "位ごとに 計算するよ。$5 - 2 = 3$、$2 - 1 = 1$ だね。",
        "action_type": "calculation",
        "highlight_target": "digits"
      },
      {
        "step_id": 3,
        "guide_text": "最後に 小数点を 忘れずに おろしてこよう。",
        "action_type": "decimal_point",
        "highlight_target": "result_point"
      }
    ]
  },
  {
    "pattern_id": "D12-U04-P06",
    "title": "整数から小数をひくときは？",
    "problem": {
      "question_text": "次の計算を筆算でしましょう。\n$3 - 1.2$",
      "numbers": {
        "a": 3,
        "b": 1.2
      },
      "answer": "1.8"
    },
    "visual_structure": {
      "summary": "3を3.0に変える工夫。",
      "elements": [
        "「3」と書かれた筆算",
        "「3」が「3.0」に変身するアニメーション",
        "0から2を引けないので、繰り下がる様子"
      ]
    },
    "steps": [
      {
        "step_id": 1,
        "guide_text": "$3$ のままでは、$1.2$ の小数部分が ひけないね。こういうときは、$3$ を $3.0$ と 考えてみよう。",
        "action_type": "rewrite",
        "highlight_target": "3_to_3_0"
      },
      {
        "step_id": 2,
        "guide_text": "十分の一の位は、$0$ から $2$ は ひけないから、一の位から $1$ くり下げよう。",
        "action_type": "borrow",
        "highlight_target": "borrow_mark"
      },
      {
        "step_id": 3,
        "guide_text": "$10 - 2 = 8$、$2 - 1 = 1$。点を打って、答えは $1.8$ だね。",
        "action_type": "calculation",
        "highlight_target": "answer"
      }
    ]
  }
]